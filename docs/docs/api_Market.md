---
id: Market
title: Market
---

<div class="contract-doc"><div class="contract"><h2 class="contract-header"><span class="contract-kind">contract</span> Market</h2><p class="description">A proxy contract for interacting with low-level contracts. All client interactions should use this contract to modify the state of the marketplace (create, access, modify listings and transactions) In practice, this proxy contract should have &quot;ownership&quot; of the low level contracts to ensure only this contract can invoke their methods by manually implementing ownership checks or using the OpenZeppelin Ownable contract. To reduce gas cost, business logic is implemented in the client app. This proxy contract can be replaced to support upgradability without losing the current data stored in the contract which is maintained by MarketStore and Escrow. Listings are never removed, use INACTIVE state to disable listings.</p><div class="source">Source: <a href="https://github.com/ks510/trade-now/blob/v1.0.0/contracts/Market.sol" target="_blank">contracts/Market.sol</a></div><div class="author">Author: Karen Suen</div></div><div class="index"><h2>Index</h2><ul><li><a href="Market.html#ListingCreated">ListingCreated</a></li><li><a href="Market.html#ListingDisabled">ListingDisabled</a></li><li><a href="Market.html#ListingSold">ListingSold</a></li><li><a href="Market.html#buyListing">buyListing</a></li><li><a href="Market.html#confirmItemReceived">confirmItemReceived</a></li><li><a href="Market.html#createListing">createListing</a></li><li><a href="Market.html#disableListing">disableListing</a></li><li><a href="Market.html#">fallback</a></li><li><a href="Market.html#getAllSellerListings">getAllSellerListings</a></li><li><a href="Market.html#getAllUserTransactionIds">getAllUserTransactionIds</a></li><li><a href="Market.html#getListing">getListing</a></li><li><a href="Market.html#getListingDescription">getListingDescription</a></li><li><a href="Market.html#getListingImage">getListingImage</a></li><li><a href="Market.html#getListingPrice">getListingPrice</a></li><li><a href="Market.html#getListingSeller">getListingSeller</a></li><li><a href="Market.html#getListingStatus">getListingStatus</a></li><li><a href="Market.html#getListingTitle">getListingTitle</a></li><li><a href="Market.html#getTotalListings">getTotalListings</a></li><li><a href="Market.html#getTransaction">getTransaction</a></li><li><a href="Market.html#getTransactionAmount">getTransactionAmount</a></li><li><a href="Market.html#getTransactionBuyer">getTransactionBuyer</a></li><li><a href="Market.html#getTransactionSeller">getTransactionSeller</a></li><li><a href="Market.html#getTransactionStatus">getTransactionStatus</a></li></ul></div><div class="reference"><h2>Reference</h2><div class="events"><h3>Events</h3><ul><li><div class="item event"><span id="ListingCreated" class="anchor-marker"></span><h4 class="name">ListingCreated</h4><div class="body"><code class="signature">event <strong>ListingCreated</strong><span>(uint id) </span></code><hr/><div class="description"><p>Event for notifying about a new listing.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>id</code> - Id of the new listing</div></dd></dl></div></div></li><li><div class="item event"><span id="ListingDisabled" class="anchor-marker"></span><h4 class="name">ListingDisabled</h4><div class="body"><code class="signature">event <strong>ListingDisabled</strong><span>(uint id) </span></code><hr/><div class="description"><p>Event for notifying about an existing listing being disabled.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>id</code> - Id of the disabled listing</div></dd></dl></div></div></li><li><div class="item event"><span id="ListingSold" class="anchor-marker"></span><h4 class="name">ListingSold</h4><div class="body"><code class="signature">event <strong>ListingSold</strong><span>(uint id) </span></code><hr/><div class="description"><p>Event for notifying about a selling a listing.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>id</code> - Id of the sold listing</div></dd></dl></div></div></li></ul></div><div class="functions"><h3>Functions</h3><ul><li><div class="item function"><span id="buyListing" class="anchor-marker"></span><h4 class="name">buyListing</h4><div class="body"><code class="signature">function <strong>buyListing</strong><span>(uint _listingId) </span><span>public </span><span>payable </span></code><hr/><div class="description"><p>Sender of this function purchases the given listing and sends the purchase funds to be held in escrow. This function assumes the correct amount of funds are sent and the listing exists so safety checks should be implemented by the client app.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_listingId</code> - The listing id to purchase with funds</div></dd></dl></div></div></li><li><div class="item function"><span id="confirmItemReceived" class="anchor-marker"></span><h4 class="name">confirmItemReceived</h4><div class="body"><code class="signature">function <strong>confirmItemReceived</strong><span>(uint _transactionId) </span><span>public </span></code><hr/><div class="description"><p>Updates a transaction to confirmed status, triggering release of buyer&#x27;s purchase funds to the seller and completing the trade.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_transactionId</code> - The id of listing to update</div></dd></dl></div></div></li><li><div class="item function"><span id="createListing" class="anchor-marker"></span><h4 class="name">createListing</h4><div class="body"><code class="signature">function <strong>createListing</strong><span>(uint _price, string _title, string _desc, string _image) </span><span>public </span></code><hr/><div class="description"><p>Create a new listing in the marketplace and notifies client with the new listing id through event. Sender of this function is assumed to be the seller of the listing.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_price</code> - The selling price of listing in Wei</div><div><code>_title</code> - The title of the listing and item for sale</div><div><code>_desc</code> - The description of the listing</div><div><code>_image</code> - The reference for accessing the image from a distributed database</div></dd></dl></div></div></li><li><div class="item function"><span id="disableListing" class="anchor-marker"></span><h4 class="name">disableListing</h4><div class="body"><code class="signature">function <strong>disableListing</strong><span>(uint _listingId) </span><span>public </span></code><hr/><div class="description"><p>Updates a listing to disabled status to indicate it is no longer available for sale.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_listingId</code> - The id of listing to update</div></dd></dl></div></div></li><li><div class="item function"><span id="fallback" class="anchor-marker"></span><h4 class="name">fallback</h4><div class="body"><code class="signature">function <strong></strong><span>(address _marketStore, address _escrow) </span><span>public </span></code><hr/><div class="description"><p>Constructor initialises instances of low-level storage contracts for this proxy contract using the given contract addresses.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_marketStore</code> - address</div><div><code>_escrow</code> - address</div></dd></dl></div></div></li><li><div class="item function"><span id="getAllSellerListings" class="anchor-marker"></span><h4 class="name">getAllSellerListings</h4><div class="body"><code class="signature">function <strong>getAllSellerListings</strong><span>(address _seller) </span><span>public </span><span>view </span><span>returns  (uint[]) </span></code><hr/><div class="description"><p>Retrieves a list of all listings created by the given address.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_seller</code> - User address to get all listings for</div></dd><dt><span class="label-return">Returns:</span></dt><dd>A list of all listing ids created by the user</dd></dl></div></div></li><li><div class="item function"><span id="getAllUserTransactionIds" class="anchor-marker"></span><h4 class="name">getAllUserTransactionIds</h4><div class="body"><code class="signature">function <strong>getAllUserTransactionIds</strong><span>(address _user) </span><span>public </span><span>view </span><span>returns  (uint[]) </span></code><hr/><div class="description"><p>Returns a list of all transactions involving the given user address.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_user</code> - User address</div></dd><dt><span class="label-return">Returns:</span></dt><dd>List of transaction ids</dd></dl></div></div></li><li><div class="item function"><span id="getListing" class="anchor-marker"></span><h4 class="name">getListing</h4><div class="body"><code class="signature">function <strong>getListing</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (uint, uint, string, string, string, address, uint) </span></code><hr/><div class="description"><p>Retrieves all information about a listing as a tuple. Note, the listing status is returned as an integer: 0 = AVAILABLE, 1 = SOLD, 2 = INACTIVE.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Listing id, price in wei, title, description, image reference, seller address, status</dd></dl></div></div></li><li><div class="item function"><span id="getListingDescription" class="anchor-marker"></span><h4 class="name">getListingDescription</h4><div class="body"><code class="signature">function <strong>getListingDescription</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (string) </span></code><hr/><div class="description"><p>Returns the reference to the description of the given listing id stored in a distributed database.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Listing description</dd></dl></div></div></li><li><div class="item function"><span id="getListingImage" class="anchor-marker"></span><h4 class="name">getListingImage</h4><div class="body"><code class="signature">function <strong>getListingImage</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (string) </span></code><hr/><div class="description"><p>Returns the reference to the image of the given listing id stored in a distributed database.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Listing image reference</dd></dl></div></div></li><li><div class="item function"><span id="getListingPrice" class="anchor-marker"></span><h4 class="name">getListingPrice</h4><div class="body"><code class="signature">function <strong>getListingPrice</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (uint) </span></code><hr/><div class="description"><p>Returns the selling price of the given listing id.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Listing price in Wei</dd></dl></div></div></li><li><div class="item function"><span id="getListingSeller" class="anchor-marker"></span><h4 class="name">getListingSeller</h4><div class="body"><code class="signature">function <strong>getListingSeller</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (address) </span></code><hr/><div class="description"><p>Returns the seller address of the given listing id.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Seller address</dd></dl></div></div></li><li><div class="item function"><span id="getListingStatus" class="anchor-marker"></span><h4 class="name">getListingStatus</h4><div class="body"><code class="signature">function <strong>getListingStatus</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (uint) </span></code><hr/><div class="description"><p>Returns the status of a listing as an integer: 0 = AVAILABLE, 1 = SOLD, 2 = INACTIVE.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Listing status</dd></dl></div></div></li><li><div class="item function"><span id="getListingTitle" class="anchor-marker"></span><h4 class="name">getListingTitle</h4><div class="body"><code class="signature">function <strong>getListingTitle</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (string) </span></code><hr/><div class="description"><p>Returns the title of the given listing id.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of listing</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Listing title</dd></dl></div></div></li><li><div class="item function"><span id="getTotalListings" class="anchor-marker"></span><h4 class="name">getTotalListings</h4><div class="body"><code class="signature">function <strong>getTotalListings</strong><span>() </span><span>public </span><span>view </span><span>returns  (uint) </span></code><hr/><div class="description"><p>Retrieve total number of listings ever stored in the marketplace.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>Total number of listings</dd></dl></div></div></li><li><div class="item function"><span id="getTransaction" class="anchor-marker"></span><h4 class="name">getTransaction</h4><div class="body"><code class="signature">function <strong>getTransaction</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (uint, address, address, uint) </span></code><hr/><div class="description"><p>Returns all information about a transaction as a tuple. Note, the transaction status is returned as an integer: 0 = AWAITING_PAYMENT, 1 = AWAITING_DELIVERY, 2 = CONFIRMED.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of the transaction</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Transaction status, buyer address, seller address, transaction amount</dd></dl></div></div></li><li><div class="item function"><span id="getTransactionAmount" class="anchor-marker"></span><h4 class="name">getTransactionAmount</h4><div class="body"><code class="signature">function <strong>getTransactionAmount</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (uint) </span></code><hr/><div class="description"><p>Returns the amount of funds (to be) held in escrow of the given transaction id.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of the transaction</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Transaction amount</dd></dl></div></div></li><li><div class="item function"><span id="getTransactionBuyer" class="anchor-marker"></span><h4 class="name">getTransactionBuyer</h4><div class="body"><code class="signature">function <strong>getTransactionBuyer</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (address) </span></code><hr/><div class="description"><p>Returns the buyer address of the given transaction id.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of the transaction</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Buyer address</dd></dl></div></div></li><li><div class="item function"><span id="getTransactionSeller" class="anchor-marker"></span><h4 class="name">getTransactionSeller</h4><div class="body"><code class="signature">function <strong>getTransactionSeller</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (address) </span></code><hr/><div class="description"><p>Returns the seller address of the given transaction id.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of the transaction</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Seller address</dd></dl></div></div></li><li><div class="item function"><span id="getTransactionStatus" class="anchor-marker"></span><h4 class="name">getTransactionStatus</h4><div class="body"><code class="signature">function <strong>getTransactionStatus</strong><span>(uint _id) </span><span>public </span><span>view </span><span>returns  (uint) </span></code><hr/><div class="description"><p>Returns the status of the given transaction id as an integer: 0 = AWAITING_PAYMENT, 1 = AWAITING_DELIVERY, 2 = CONFIRMED.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_id</code> - Id of the transaction</div></dd><dt><span class="label-return">Returns:</span></dt><dd>Transaction status</dd></dl></div></div></li></ul></div></div></div>
